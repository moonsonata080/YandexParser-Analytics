<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –¢–µ—Å—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ ID</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .test-data {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ ID - YandexParser Analytics</h1>
    
    <div class="test-section">
        <h2>üìä –°—Ç–∞—Ç—É—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</h2>
        <div id="extensionStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å...</div>
        <button onclick="checkExtensionStatus()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <button onclick="clearData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="clearLog()">üìù –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div class="test-section">
        <h2>üß™ –¢–µ—Å—Ç—ã –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏</h2>
        <button onclick="testUniqueCards()">‚úÖ –¢–µ—Å—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫</button>
        <button onclick="testDuplicateCards()">‚ùå –¢–µ—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤</button>
        <button onclick="testMixedCards()">üîÄ –¢–µ—Å—Ç —Å–º–µ—à–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="testCardsWithoutID()">‚ö†Ô∏è –¢–µ—Å—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –±–µ–∑ ID</button>
        <button onclick="testLargeDataset()">üìà –¢–µ—Å—Ç –±–æ–ª—å—à–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</button>
    </div>

    <div class="test-section">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalSent">0</div>
                <div>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalUnique">0</div>
                <div>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDuplicates">0</div>
                <div>–î—É–±–ª–∏–∫–∞—Ç–æ–≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="efficiency">0%</div>
                <div>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <div id="testDataPreview" class="test-data">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —Ç–µ—Å—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ</div>
    </div>
    
    <div class="test-section">
        <h2>üìä –õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="testLog" class="log">–õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É—Å—Ç...</div>
    </div>

    <script>
        let logElement;
        let testStats = {
            totalSent: 0,
            totalUnique: 0,
            totalDuplicates: 0
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            logElement = document.getElementById('testLog');
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkExtensionStatus();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            
            if (logElement) {
                logElement.innerHTML += logEntry + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
            }
            
            console.log(logEntry);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        function clearLog() {
            if (logElement) {
                logElement.innerHTML = '–õ–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—á–∏—â–µ–Ω...<br>';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('totalSent').textContent = testStats.totalSent;
            document.getElementById('totalUnique').textContent = testStats.totalUnique;
            document.getElementById('totalDuplicates').textContent = testStats.totalDuplicates;
            
            const efficiency = testStats.totalSent > 0 
                ? ((testStats.totalUnique / testStats.totalSent) * 100).toFixed(1)
                : 0;
            document.getElementById('efficiency').textContent = efficiency + '%';
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        function checkExtensionStatus() {
            log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è...');
            
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                    log(`‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ: ${chrome.runtime.id}`);
                    
                    chrome.runtime.sendMessage({action: 'getCollectedData'}, (response) => {
                        if (chrome.runtime.lastError) {
                            log(`‚ùå –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏: ${chrome.runtime.lastError.message}`, 'error');
                            updateStatus('‚ùå –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º', 'error');
                        } else if (response) {
                            log(`‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã: ${response.data?.length || 0} –∫–∞—Ä—Ç–æ—á–µ–∫`);
                            updateStatus('‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                        }
                    });
                } else {
                    log('‚ùå chrome.runtime –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    updateStatus('‚ùå –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ', 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type) {
            const statusElement = document.getElementById('extensionStatus');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `status ${type}`;
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        function clearData() {
            log('üóëÔ∏è –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è...');
            
            chrome.runtime.sendMessage({action: 'clearData'}, (response) => {
                if (chrome.runtime.lastError) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ${chrome.runtime.lastError.message}`, 'error');
                } else {
                    log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
                    testStats = { totalSent: 0, totalUnique: 0, totalDuplicates: 0 };
                    updateStats();
                }
            });
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function sendTestData(testCards, testName) {
            log(`üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞: ${testName}`);
            log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ${testCards.length} –∫–∞—Ä—Ç–æ—á–µ–∫...`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            const preview = document.getElementById('testDataPreview');
            preview.innerHTML = `<strong>${testName}:</strong><br>` + 
                testCards.map(card => `ID: ${card.id || '–ù–ï–¢'} - ${card.title}`).join('<br>');
            
            testStats.totalSent += testCards.length;
            
            chrome.runtime.sendMessage({
                action: 'addClinicData',
                data: testCards,
                url: window.location.href,
                timestamp: Date.now()
            }, (response) => {
                if (chrome.runtime.lastError) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${chrome.runtime.lastError.message}`, 'error');
                } else {
                    log(`‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: ${JSON.stringify(response)}`);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    setTimeout(() => {
                        chrome.runtime.sendMessage({action: 'getCollectedData'}, (response) => {
                            if (response && response.data) {
                                const currentTotal = response.data.length;
                                testStats.totalUnique = currentTotal;
                                testStats.totalDuplicates = testStats.totalSent - testStats.totalUnique;
                                updateStats();
                                log(`üìä –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${testStats.totalUnique} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑ ${testStats.totalSent} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö`);
                            }
                        });
                    }, 1000);
                }
            });
        }
        
        // –¢–µ—Å—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        function testUniqueCards() {
            const testCards = [
                { id: 'unique_001', title: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 1', address: '–ê–¥—Ä–µ—Å 1' },
                { id: 'unique_002', title: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 2', address: '–ê–¥—Ä–µ—Å 2' },
                { id: 'unique_003', title: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 3', address: '–ê–¥—Ä–µ—Å 3' },
                { id: 'unique_004', title: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 4', address: '–ê–¥—Ä–µ—Å 4' },
                { id: 'unique_005', title: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 5', address: '–ê–¥—Ä–µ—Å 5' }
            ];
            
            sendTestData(testCards, '–¢–µ—Å—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫');
        }
        
        // –¢–µ—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        function testDuplicateCards() {
            const testCards = [
                { id: 'duplicate_001', title: '–î—É–±–ª–∏–∫–∞—Ç –∫–ª–∏–Ω–∏–∫–∞ 1', address: '–ê–¥—Ä–µ—Å 1' },
                { id: 'duplicate_001', title: '–î—É–±–ª–∏–∫–∞—Ç –∫–ª–∏–Ω–∏–∫–∞ 1 (–∫–æ–ø–∏—è)', address: '–ê–¥—Ä–µ—Å 1' },
                { id: 'duplicate_002', title: '–î—É–±–ª–∏–∫–∞—Ç –∫–ª–∏–Ω–∏–∫–∞ 2', address: '–ê–¥—Ä–µ—Å 2' },
                { id: 'duplicate_002', title: '–î—É–±–ª–∏–∫–∞—Ç –∫–ª–∏–Ω–∏–∫–∞ 2 (–∫–æ–ø–∏—è)', address: '–ê–¥—Ä–µ—Å 2' },
                { id: 'duplicate_001', title: '–î—É–±–ª–∏–∫–∞—Ç –∫–ª–∏–Ω–∏–∫–∞ 1 (–µ—â–µ –∫–æ–ø–∏—è)', address: '–ê–¥—Ä–µ—Å 1' }
            ];
            
            sendTestData(testCards, '–¢–µ—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è 2 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)');
        }
        
        // –¢–µ—Å—Ç —Å–º–µ—à–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function testMixedCards() {
            const testCards = [
                { id: 'mixed_001', title: '–°–º–µ—à–∞–Ω–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 1', address: '–ê–¥—Ä–µ—Å 1' },
                { id: 'mixed_002', title: '–°–º–µ—à–∞–Ω–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 2', address: '–ê–¥—Ä–µ—Å 2' },
                { id: 'mixed_001', title: '–°–º–µ—à–∞–Ω–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 1 (–¥—É–±–ª–∏–∫–∞—Ç)', address: '–ê–¥—Ä–µ—Å 1' },
                { id: 'mixed_003', title: '–°–º–µ—à–∞–Ω–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 3', address: '–ê–¥—Ä–µ—Å 3' },
                { id: 'mixed_002', title: '–°–º–µ—à–∞–Ω–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 2 (–¥—É–±–ª–∏–∫–∞—Ç)', address: '–ê–¥—Ä–µ—Å 2' },
                { id: 'mixed_004', title: '–°–º–µ—à–∞–Ω–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ 4', address: '–ê–¥—Ä–µ—Å 4' }
            ];
            
            sendTestData(testCards, '–¢–µ—Å—Ç —Å–º–µ—à–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è 4 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)');
        }
        
        // –¢–µ—Å—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –±–µ–∑ ID
        function testCardsWithoutID() {
            const testCards = [
                { title: '–ö–ª–∏–Ω–∏–∫–∞ –±–µ–∑ ID 1', address: '–ê–¥—Ä–µ—Å 1' },
                { id: 'with_id_001', title: '–ö–ª–∏–Ω–∏–∫–∞ —Å ID 1', address: '–ê–¥—Ä–µ—Å 2' },
                { title: '–ö–ª–∏–Ω–∏–∫–∞ –±–µ–∑ ID 2', address: '–ê–¥—Ä–µ—Å 3' },
                { id: 'with_id_002', title: '–ö–ª–∏–Ω–∏–∫–∞ —Å ID 2', address: '–ê–¥—Ä–µ—Å 4' },
                { title: '–ö–ª–∏–Ω–∏–∫–∞ –±–µ–∑ ID 3', address: '–ê–¥—Ä–µ—Å 5' }
            ];
            
            sendTestData(testCards, '–¢–µ—Å—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –±–µ–∑ ID (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è)');
        }
        
        // –¢–µ—Å—Ç –±–æ–ª—å—à–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
        function testLargeDataset() {
            const testCards = [];
            
            // –°–æ–∑–¥–∞–µ–º 50 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            for (let i = 1; i <= 50; i++) {
                testCards.push({
                    id: `large_${i.toString().padStart(3, '0')}`,
                    title: `–ë–æ–ª—å—à–æ–π —Ç–µ—Å—Ç –∫–ª–∏–Ω–∏–∫–∞ ${i}`,
                    address: `–ê–¥—Ä–µ—Å ${i}`
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º 25 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
            for (let i = 1; i <= 25; i++) {
                testCards.push({
                    id: `large_${i.toString().padStart(3, '0')}`,
                    title: `–ë–æ–ª—å—à–æ–π —Ç–µ—Å—Ç –∫–ª–∏–Ω–∏–∫–∞ ${i} (–¥—É–±–ª–∏–∫–∞—Ç)`,
                    address: `–ê–¥—Ä–µ—Å ${i}`
                });
            }
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤
            for (let i = testCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [testCards[i], testCards[j]] = [testCards[j], testCards[i]];
            }
            
            sendTestData(testCards, '–¢–µ—Å—Ç –±–æ–ª—å—à–æ–≥–æ –Ω–∞–±–æ—Ä–∞ (75 –∫–∞—Ä—Ç–æ—á–µ–∫, –¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è 50 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)');
        }
        
        // –°–ª—É—à–∞–µ–º –æ—à–∏–±–∫–∏
        window.addEventListener('error', function(event) {
            log(`‚ùå JavaScript –æ—à–∏–±–∫–∞: ${event.message}`, 'error');
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updateStats();
    </script>
</body>
</html>
