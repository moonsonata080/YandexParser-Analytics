<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è YandexParser Analytics</h1>
    
    <div class="test-section">
        <h2>üìã –°—Ç–∞—Ç—É—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</h2>
        <div id="extensionStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å...</div>
        <button onclick="checkExtensionStatus()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div class="test-section">
        <h2>üß™ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
        <button onclick="testMessagePassing()">üì® –¢–µ—Å—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</button>
        <button onclick="testDataCollection()">üè• –¢–µ—Å—Ç —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="testAutoScroll()">üîÑ –¢–µ—Å—Ç –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏</button>
    </div>
    
    <div class="test-section">
        <h2>üìä –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
        <div id="eventLog" class="log">–õ–æ–≥ –ø—É—Å—Ç...</div>
    </div>
    
    <div class="test-section">
        <h2>üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h2>
        <ol>
            <li><strong>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ</strong> –≤ chrome://extensions/</li>
            <li><strong>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ</strong> –µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏</li>
            <li><strong>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å"</strong> –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</li>
            <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞</strong> (F12 ‚Üí Console) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫</li>
        </ol>
    </div>

    <script>
        let logElement;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            logElement = document.getElementById('eventLog');
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkExtensionStatus();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            
            if (logElement) {
                logElement.innerHTML += logEntry + '<br>';
                logElement.scrollTop = logElement.scrollHeight;
            }
            
            console.log(logEntry);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        function clearLog() {
            if (logElement) {
                logElement.innerHTML = '–õ–æ–≥ –æ—á–∏—â–µ–Ω...<br>';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        function checkExtensionStatus() {
            log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å chrome.runtime
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    log('‚úÖ chrome.runtime –¥–æ—Å—Ç—É–ø–µ–Ω');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º ID —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
                    if (chrome.runtime.id) {
                        log(`‚úÖ ID —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: ${chrome.runtime.id}`);
                        
                        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
                        chrome.runtime.sendMessage({action: 'getCollectedData'}, (response) => {
                            if (chrome.runtime.lastError) {
                                log(`‚ùå –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏: ${chrome.runtime.lastError.message}`, 'error');
                                updateStatus('‚ùå –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º', 'error');
                            } else if (response) {
                                log(`‚úÖ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: ${JSON.stringify(response)}`);
                                updateStatus('‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                            } else {
                                log('‚ö†Ô∏è –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è', 'warning');
                                updateStatus('‚ö†Ô∏è –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è', 'warning');
                            }
                        });
                    } else {
                        log('‚ùå ID —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                        updateStatus('‚ùå ID —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    }
                } else {
                    log('‚ùå chrome.runtime –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    updateStatus('‚ùå chrome.runtime –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${error.message}`, 'error');
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type) {
            const statusElement = document.getElementById('extensionStatus');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `status ${type}`;
            }
        }
        
        // –¢–µ—Å—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        function testMessagePassing() {
            log('üì® –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥–∞—á—É —Å–æ–æ–±—â–µ–Ω–∏–π...');
            
            try {
                chrome.runtime.sendMessage({action: 'getCollectionLimit'}, (response) => {
                    if (chrome.runtime.lastError) {
                        log(`‚ùå –û—à–∏–±–∫–∞: ${chrome.runtime.lastError.message}`, 'error');
                    } else {
                        log(`‚úÖ –ü–æ–ª—É—á–µ–Ω –ª–∏–º–∏—Ç: ${JSON.stringify(response)}`);
                    }
                });
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –¢–µ—Å—Ç —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
        function testDataCollection() {
            log('üè• –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–Ω–∏–∫
                const testData = [{
                    id: 'test-001',
                    title: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–ª–∏–Ω–∏–∫–∞',
                    address: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å',
                    coordinates: [55.7558, 37.6176],
                    rating: 4.5,
                    reviewCount: 100,
                    dataQuality: 0.8
                }];
                
                chrome.runtime.sendMessage({
                    action: 'addClinicData',
                    data: testData,
                    url: window.location.href,
                    timestamp: Date.now()
                }, (response) => {
                    if (chrome.runtime.lastError) {
                        log(`‚ùå –û—à–∏–±–∫–∞: ${chrome.runtime.lastError.message}`, 'error');
                    } else {
                        log(`‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã: ${JSON.stringify(response)}`);
                    }
                });
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –¢–µ—Å—Ç –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        function testAutoScroll() {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É...');
            
            try {
                chrome.runtime.sendMessage({action: 'startAutoScroll'}, (response) => {
                    if (chrome.runtime.lastError) {
                        log(`‚ùå –û—à–∏–±–∫–∞: ${chrome.runtime.lastError.message}`, 'error');
                    } else {
                        log(`‚úÖ –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞: ${JSON.stringify(response)}`);
                        
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            chrome.runtime.sendMessage({action: 'stopAutoScroll'}, (response) => {
                                log(`‚úÖ –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${JSON.stringify(response)}`);
                            });
                        }, 2000);
                    }
                });
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        window.addEventListener('message', function(event) {
            if (event.source !== window) return;
            
            log(`üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: ${event.data.type || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø'}`);
        });
        
        // –°–ª—É—à–∞–µ–º –æ—à–∏–±–∫–∏
        window.addEventListener('error', function(event) {
            log(`‚ùå JavaScript –æ—à–∏–±–∫–∞: ${event.message}`, 'error');
        });
        
        // –°–ª—É—à–∞–µ–º –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–∏—Å—ã
        window.addEventListener('unhandledrejection', function(event) {
            log(`‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>
